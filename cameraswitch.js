const video=document.getElementById('arjs-video');const button=document.getElementById('buttoncamera');const select=document.getElementById('selectcamera');select.hidden=true;button.hidden=false;let currentStream;let videoDevices=[];let currentDeviceIndex=0;function stopMediaTracks(stream){stream.getTracks().forEach(track=>{track.stop();});}
function gotDevices(mediaDevices){if(currentDeviceIndex===0){select.innerHTML='';const defaultOption=document.createElement('option');defaultOption.value='';defaultOption.textContent='Select a camera';defaultOption.selected=true;defaultOption.disabled=true;select.appendChild(defaultOption);let count=1;videoDevices=mediaDevices.filter(device=>device.kind==='videoinput');videoDevices.forEach(mediaDevice=>{const option=document.createElement('option');option.value=mediaDevice.deviceId;const label=mediaDevice.label||`Camera ${count++}`;const textNode=document.createTextNode(label);option.appendChild(textNode);select.appendChild(option);});}}
let firstRun=true;function selectNextOption(){if(firstRun&&videoDevices.length>1){currentDeviceIndex++;currentDeviceIndex++;firstRun=false;}
currentDeviceIndex=currentDeviceIndex<videoDevices.length-1?currentDeviceIndex+1:0;select.value=videoDevices[currentDeviceIndex].deviceId;}
button.addEventListener('click',event=>{if(typeof currentStream!=='undefined'){stopMediaTracks(currentStream);}
selectNextOption();const videoConstraints={};if(select.value===''){videoConstraints.facingMode='environment';}else{videoConstraints.deviceId={exact:select.value};}
const constraints={video:videoConstraints,audio:false};navigator.mediaDevices.getUserMedia(constraints).then((stream)=>{currentStream=stream;document.getElementById('arjs-video').srcObject=stream;var event=new CustomEvent("camera-init",{stream:stream});window.dispatchEvent(event);document.body.addEventListener("click",function(){document.getElementById('arjs-video').play();});return navigator.mediaDevices.enumerateDevices();}).then(gotDevices).catch((error)=>{console.error(error);});});select.addEventListener('change',event=>{if(typeof currentStream!=='undefined'){stopMediaTracks(currentStream);}
const videoConstraints={};if(select.value===''){videoConstraints.facingMode='environment';}else{videoConstraints.deviceId={exact:select.value};}
const constraints={video:videoConstraints,audio:false};navigator.mediaDevices.getUserMedia(constraints).then((stream)=>{currentStream=stream;document.getElementById('arjs-video').srcObject=stream;var event=new CustomEvent("camera-init",{stream:stream});window.dispatchEvent(event);document.body.addEventListener("click",function(){document.getElementById('arjs-video').play();});return navigator.mediaDevices.enumerateDevices();}).then(gotDevices).then(()=>{if(videoConstraints.deviceId){select.value=videoConstraints.deviceId.exact;}}).catch((error)=>{console.error(error);});});navigator.mediaDevices.enumerateDevices().then(gotDevices);